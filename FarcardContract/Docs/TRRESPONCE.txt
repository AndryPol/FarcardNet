function TransactionsEx(
  Count: DWORD; List: Pointer;
  InpBuf: Pointer; InpLen: DWORD; InpKind: Word;
  var OutBuf: Pointer; var OutLen: DWORD; var OutKind: Word
  ): Integer; stdcall;
Эта функция проводит транзакции для кассового чека Или пречека (<FIXME/>)

  
параметры:
Count       - количество транзакций
List        - адрес списка, каждый элемент котoрого - ссылка (Pointer) на описание транзакции (см. ниже)
InpBuf      - дополнительная информация от кассы о чеке, внимание, отсутствует завершающий 0, поэтому нельзя работать с InpBuf как PChar, необходимо использовать длину InpLen (в Delphi подходящая процедура SetString())
InpLen      - длина информации от кассы
InpKind     - тип информации от кассы  (1-XML)
OutBuf      - дополнительная ответная информация
OutLen      - длина ответной информации 
OutKind     - тип ответной информации (1-XML)

Описание XML ответа (на основе этого XML генерируются сообщения об ошибках и предупреждениях, в макет чека подставляются слипы, происходит добавление записей или заполнение полей в таблице транзакций (IntfTransactions))

  
<TRRESPONSE error_code="157" dts="2012-04-15T20:32:00" err_text="no error" placeid="REST01:CASH03">
    <TRANSACTION ext_id="sdfgfsdgfsdg453" cardcode="123123123" num="1" dts="2012-04-15T20:32:00"/>
    <TRANSACTION ext_id="iuqwyeq67846tgd" cardcode="123123123" num="0" uni="321432" dts="2012-04-15T20:32:01" slip="XXX
YYY" subaccount="2" value="123" extinfo="BonusAdded=1"/>
  <TRANSACTION ext_id="432432432" cardcode="123123123" num="0" uni="321432" dts="2012-04-15T20:32:01" slip="XXX
YYY" subaccount="4" value="13" extinfo="SomeInfo=1"/>
    <PRINTDOCUMENT code="101" cardcode="123123123">
        <DOCUMENTDATA>
            <TEXT00>Некий текст для печати</TEXT00>
            <TEXT01>Другая информация для печати</TEXT01>
            <TEXT02>004452112312311234</TEXT02>
        </DOCUMENTDATA>
    </PRINTDOCUMENT>
</TRRESPONSE>

          
error_code - integer (опция, если нет ошибки. если есть то <> 0)
dts - datetime (опция) выполнения транзакций
err_text - string (опция), если заполнен, но error_code=0 (или отсутствует), то считается, не ошибкой, а замечанием, которое желательно показать пользователю
placeid - string (опция) - идентификатор места проведения транзакции, может зависеть от кассы, сохранится в IntfTransactions.ExtPlaceID

PRINTDOCUMENT - информация для печати купона. code в RK7 ссылается на документ (не макет), предустановленный документ имеет код 101.
В протоколе 29 (FarCards версии до 6.03) была проблема, чтобы вернуть XML (текст ошибки транзакции), надо было вернуть успех, что плохо из за несовместимости с более старыми протоколами. В протоколе 30 (FarCards версии 6.04+) эта проблема устранена. Соответственно, всячески рекомендуется всем, кто хочет возвращать информацию об ошибке на транзакции, возвращать XML вида

  
<TRRESPONSE error_code="157" err_text="Error!!!"/>
вместе с ошибочным результатом функции TransactionsEx, указав в описании минимальную версию FarCards 6.04.

  
По транзакциям:
TRANSACTION - тег, возвращаемый внешней системой на каждую проведенную внешней системой транзакцию, о которой она хочет уведомить нас. каждая транзакция может иметь сви атрибуты. 	
cardcode - string (обязательный) код карты транзакции, сохранится RK7 в IntfTransactions.CardCode
num - integer (обязательный или num или uni) порядковый номер транзакции в пакете (начиная с 1). Если num=0 то такая транзакция будет добавлена.
uni - integer (обязательный или num или uni) идентификатор строки в чеке (см. атрибут uni в тэгах 'LINE','PAYMENT','DISCOUNT'), к которому привязана транзакция, сохранится RK7 в IntfTransactions.LineUni . Если UNI не задан - то не будет печати и сохранения slip. Прочая информация сохранится.
linetag - string (обязатльный, если заполнен uni) - один из 'LINE','PAYMENT','DISCOUNT', сохранится RK7 в IntfTransactions.LineTag
ext_id - string (опция) идентификатор во внешней системе (задается внешней системой, будет сохранен RK7 в IntfTransactions.ExtTransactionID)
slip - string (опция) информация для печати
subaccount - integer (опция) номер субсчёта, может не совпадать с номером субсчета, возвращаемом в инфо о карте, сохранится RK7 в IntfTransactions.ExtSubaccount
value - int64 (опция) значение транзакции (в копейках), если задан, то перекроет подготовленное значение транзакции, сохранится RK7 в IntfTransactions.Value
dts - datetime (опция), если заполнено, то перекрывает общий dts, заданный для TRRESPONSE, сохранится RK7 в IntfTransactions.ExtDateTime
extinfo - string (опция) произвольная дополнительная информация, сохранится RK7 в IntfTransactions.ExtInfo  
Содержимое extinfo стандардизируется под конкретные проекты.

PRINTDOCUMENT

Необходимо распечатать документ с кодом code=«10054» для карточки cardcode, используя данные, переданные в ответе. Тег DOCUMENTDATA содержит значения полей. На данный момент значения полей фиксированные (TEXT00 - TEXT09). В дальнейшем предполагается использование переменных с произвольными названиями. Кассовая сторона использует механизм макетов для документа, размещая данные в указанном пользователями виде (например, TEXT02 может быть штрих-кодом).